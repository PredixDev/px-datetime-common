<link rel="import" href="px-datetime-imports.html" />

<script>

/**
  ```pxDatetimeBehavior```

  This behavior is for all ```px-{datetime}-{picker}``` components.

  Dependencies: momentjs

  @polymerBehavior pxDatetimeBehavior
*/

var pxDatetimeBehavior = {

  properties: {
     /**
     * Moment format string for the DATE format to display/validate this field against
     * (see http://momentjs.com/docs/#/parsing/string-format/)
     *
     */
    dateFormat: {
        type: String,
        value: 'YYYY/MM/DD'
    },
    /**
    * Moment format string for the TIME format to display/validate this field against
    * (see http://momentjs.com/docs/#/parsing/string-format/)
    *
    */
    timeFormat: {
        type: String,
        value: 'HH:mm A'
    },
    /**
     *
     * Set this attribute when you do want to allow future dates in the 'px-date-panel' component.
     *
     * Defined In: 'pxDatetimeBehavior'
     *
     * @default false (future dates will be disabled and unclickable)
     */
    blockFutureDates: {
      type: Boolean,
      value: false
    },
    /**
     * Moment value with the date or time to display.  Will be parsed according to the moment format.  (see momentFormat property)
     * Default to now.
     * Defined In: 'pxDatetimeBehavior'
     *
     * @private
     */
    momentObj: {
      type: Object,
      notify: true,
      value: function() {
                return moment();
              }
    },
    /**
     *
     * Moment-timezone string for using a specific timezone. See
     * http://momentjs.com/timezone/docs/#/data-loading/getting-zone-names/
     *
     * if not provided tries to guess the current local
     */
    timeZone: {
      type: String,
      notify: true,
      value: function() {
        return moment.tz.guess();
      },
      observer: '_timeZoneChanged'
    },
    /**
     *
     * This is the string you use to interact with px-datetime components. it holds
     * a date and time representing the value in the related component
     *
     * Format ISO8601 strings
     * ```
     * "2013-01-07T22:44:30.652Z"
     * ```
     *
     * This will be changed when the user Submits their new date/time.
     *
     */
    dateTime: {
      type: String,
      value: '',
      observer: '_notifyDateTimeChanged'
    }
  }, //properties close bracket

  /**
   * Takes an ISO 8601 String and returns a moment object
   *
   * Defined In: 'pxDatetimeBehavior'
   *
   * @param {String} timeString
   */
  _convertISOtoMoment: function(timeString) {
    if(this.isUtc) {
      return moment.utc(timeString, moment.ISO_8601);
    }
    else {
      return moment(timeString, moment.ISO_8601);
    }
  },
  /**
   * makes sure the moment object reflexts the timezone
   */
  _timeZoneChanged: function() {
    if(this.momentObj) {
      var newMom = this.momentObj.clone().tz(this.timeZone);
      this.set('momentObj', newMom);
    }
  },
  /**
   * Copies the time in toPreserve to dest and returns dest.
   *
   */
  _preserveTime: function(toPreserve, dest) {
    if(toPreserve && dest) {
      dest.hours(toPreserve.hours());
      dest.minutes(toPreserve.minutes());
      dest.seconds(toPreserve.seconds());
      dest.milliseconds(toPreserve.milliseconds());
    }
    return dest;
  },
  /**
   * px-datetime-submitted event. This event is fired differently depending on config:
   *  -If the px-datetim component has an apply button then it is fired when the
   *   user clicks the apply button (or press enter) AND the date/time is valid
   *  -If the px-datetim component does not have an apply button then it is fired
   *   every time a change is made to the date/time AND the date/time is valid
   *
   * @event px-datetime-submitted
   * @type {object}
   * @property {string} dateTime - the ISO 8601 String representing the date/time chosen by the user
   * @property {object} momentObj - the moment.js object representing the date/time chosen by the user
   */
  _notifyDateTimeChanged: function(dateTime) {
    this.fire('px-datetime-submitted', {dateTime: this.dateTime, momentObj: this.momentObj});
  }
}; //pxDatetimeBehavior close bracket

</script>
