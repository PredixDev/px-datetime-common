<link rel="import" href="px-datetime-shared-behavior.html" />

<script>
var PxDatetimeBehavior = PxDatetimeBehavior || {};

/*
    PxDatetimeBehavior.rangeMoments

    Description:
    Behavior providing the fromMoment and toMoment properties
    @polymerBehavior PxDatetimeBehavior.rangeMoments
*/
PxDatetimeBehavior.rangeMoments = {
  properties: {
    /**
     * Moment object start date & time
     *
     * @private
     */
    fromMoment: {
      type: Object,
      notify: true
    },
    /**
     * Moment object end date & time
     *
     * @private
     */
    toMoment: {
      type: Object,
      notify: true
    }
  }
}

/**
  ```pxDatetimeRangeBehavior```

  This behavior is for all ```px-{datetime}-range-{picker}``` components.

  Dependencies: momentjs

  @polymerBehavior pxDatetimeRangeBehavior
*/
var pxDatetimeRangeBehavior = [{

  properties: {

    /**
     * (optional:  'px-{datetime}-range-panel')
     *
     * The preset date/time ranges to be displayed.
     *
     *```
     *   [
     *    {
     *      "displayText": "Last 5 Minutes",
     *      "startDateTime": "2013-02-04T22:44:30.652Z",
     *      "endDateTime": "2013-02-04T22:49:30.652Z"
     *    },
     *    {
     *      "displayText": "Last 12 Hours",
     *      "startDateTime": "2013-02-04T10:44:30.652Z",
     *      "endDateTime": "2013-02-04T22:49:30.652Z"
     *    }
     *   ]
     * ```
     *
     * @default no presetRanges
     */
    presetRanges: Object, //may be useless

  },
  observers: [
    // '_notifyRangeChanged(range.*)',
    '_localeChanged(language)',
    '_timeZoneChanged(timeZone)'
  ],
  /**
   */
  _localeChanged: function() {
    if(this.language !== undefined) {
      //make sure the moment obj pick up the possibly new moment locale
      if(this.fromMoment) {
        this.set('fromMoment', this.fromMoment.locale(Px.moment.locale()));
      }
      if(this.toMoment) {
        this.set('toMoment', this.toMoment.locale(Px.moment.locale()));
      }
    }
  },
  /**
   * makes sure the moment objects reflect the timezone
   */
  _timeZoneChanged: function() {
    if(this.timeZone !== undefined) {
      if(this.fromMoment) {
        var newMom = this.fromMoment.clone().tz(this.timeZone);
        this.set('fromMoment', newMom);
      }
      if(this.toMoment) {
        newMom = this.toMoment.clone().tz(this.timeZone);
        this.set('toMoment', newMom);
      }
    }
  },
  /**
   * Validation for the range. Makes sure the ranges are in chronological order
   *
   * @return {Boolean} true if chronological order, false otherwise
   */
  _validateRangeOrder: function(fromMoment, toMoment) {
    // if the from date is before the to date, everything is ok
    if(fromMoment && toMoment) {
      return fromMoment.isBefore(toMoment);
    }else {
      return false;
    }
  },
}, pxDatetimeSharedBehavior, PxDatetimeBehavior.rangeMoments];


</script>
